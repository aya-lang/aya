.# This file is a part of Aya: https://github.com/nick-paul/aya-lang

.# socket.aya
.# Defines socket and socket_server types

struct socket {
    _sock
}

struct socket_server {
    _srv
}

def socket_server::accept {self: socket^,
    self._srv :(socket.accept) socket!
}

.# static method
def socket_server::listen {addr::str port::num cls,
    addr port :(socket.open_server) cls!
}

def socket_server::close {self,
    self._srv :(socket.close)
}

def socket_server::port {self,
    self._srv :(socket.get_port)
}

def socket_server::addr {self,
    self._srv :(socket.get_addr)
}

def socket::connect {addr::str port::num cls,
    addr port :(socket.open_client) cls!
}

def socket::recv {self,
    self._sock :(socket.recv)
}

def socket::port {self,
    self._sock :(socket.get_port)
}

def socket::addr {self,
    self._sock :(socket.get_addr)
}

def socket::send {self,
    self._sock :(socket.send)
}

def socket::println {data self,
    data P "\r\n" + self._sock :(socket.send)
}

def socket::close {self,
    self._sock :(socket.close)
}
